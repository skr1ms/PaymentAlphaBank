<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–¢–µ—Å—Ç –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        input, select { width: 200px; padding: 5px; margin: 5px; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã –∫—É–ø–æ–Ω–æ–≤</h1>
    
    <div class="section">
        <h2>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—É–ø–æ–Ω–æ–≤</h2>
        <button onclick="loadCoupons()">–ó–∞–≥—Ä—É–∑–∏—Ç—å –∫—É–ø–æ–Ω—ã</button>
        <div id="coupons-result" class="result"></div>
    </div>
    
    <div class="section">
        <h2>2. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
        <div>
            <label>–ö—É–ø–æ–Ω:</label>
            <select id="couponSelect">
                <option value="1">–°–∫–∏–¥–∫–∞ 10% (100 —Ä—É–±.)</option>
                <option value="2">–°–∫–∏–¥–∫–∞ 20% (200 —Ä—É–±.)</option>
                <option value="3">–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞ (50 —Ä—É–±.)</option>
                <option value="4">–°–∫–∏–¥–∫–∞ 50% (500 —Ä—É–±.)</option>
            </select>
        </div>
        <div>
            <label>User ID:</label>
            <input type="text" id="userId" value="skr1ms_test_${Date.now()}">
        </div>
        <button onclick="createOrder()">–°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑</button>
        <div id="order-result" class="result"></div>
    </div>
    
    <div class="section">
        <h2>3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞</h2>
        <input type="text" id="orderNumber" placeholder="–ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞">
        <button onclick="checkStatus()">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
        <div id="status-result" class="result"></div>
    </div>

    <script>
        let lastOrderNumber = '';
        
        function loadCoupons() {
            fetch('/api/coupons')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('coupons-result').textContent = JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    document.getElementById('coupons-result').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                });
        }

        function createOrder() {
            const couponId = document.getElementById('couponSelect').value;
            const userId = document.getElementById('userId').value;
            
            const orderData = {
                coupon_id: parseInt(couponId),
                user_id: userId,
                return_url: window.location.origin + '/payment/return',
                fail_url: window.location.origin + '/payment/return'
            };

            fetch('/api/orders', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(orderData)
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('order-result').textContent = JSON.stringify(data, null, 2);
                
                if (data.success && data.payment_url) {
                    const orderNumberMatch = data.payment_url.match(/orderNumber=([^&]+)/);
                    if (orderNumberMatch) {
                        lastOrderNumber = orderNumberMatch[1];
                        document.getElementById('orderNumber').value = lastOrderNumber;
                    }
                    
                    document.getElementById('order-result').innerHTML += 
                        '\n\n<a href="' + data.payment_url + '" target="_blank" style="background: green; color: white; padding: 10px; text-decoration: none; border-radius: 5px;">üöÄ –ü–ï–†–ï–ô–¢–ò –ö –û–ü–õ–ê–¢–ï</a>';
                }
            })
            .catch(error => {
                document.getElementById('order-result').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
            });
        }

        function checkStatus() {
            const orderNumber = document.getElementById('orderNumber').value;
            if (!orderNumber) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞');
                return;
            }

            fetch('/api/orders/' + orderNumber + '/status')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('status-result').textContent = JSON.stringify(data, null, 2);
                })
                .catch(error => {
                    document.getElementById('status-result').textContent = '–û—à–∏–±–∫–∞: ' + error.message;
                });
        }

        // –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –∫—É–ø–æ–Ω–æ–≤ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            loadCoupons();
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π User ID
            document.getElementById('userId').value = 'skr1ms_test_' + Date.now();
        };
    </script>
</body>
</html>